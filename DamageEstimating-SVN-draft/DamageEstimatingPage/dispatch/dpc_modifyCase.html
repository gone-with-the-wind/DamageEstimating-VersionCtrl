<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>修改案件</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/datetimepicker.css">
    <link href="../css/main.css" rel="stylesheet">
    <style>
.popover{background:#C00;color:#FFF;}
.popover .popover-content{padding:1px 5px;}
.popover.bottom>.arrow::after{border-bottom-color:#C00;}
.has-error input,
.has-error textarea,
.has-error select{background-color:#F2DEDE;}
.has-success input,
.has-success textarea,
.has-success select{background-color:#DFF0D8}
    </style>
</head>
<body ng-app="app" ng-controller="ctrl">
<div class="m_header">
    <a class="m_headerLeft" href="login.html">
        <i class="glyphicon glyphicon-user"></i><span class="ml10">用户名</span>
    </a>
    <div class="m_headerRight">
        <h3>新东方管理平台</h3>
    </div>
</div>
<div class="m_nav">
    <ul class="m_navUl">
        <li>
            <a class="m_navA active" href="dispatch.html"><i class="glyphicon glyphicon-log-out mr10"></i>调度</a>
            <ul class="m_nav_ul">
                <li><a class="m_nav_a active" href="dispatch.html"><i class="glyphicon glyphicon-option-horizontal mr10"></i>未调度</a></li>
                <li><a class="m_nav_a" href="dispatch_backCase.html"><i class="glyphicon glyphicon-remove mr10"></i>退回案件查询</a></li>
                <li><a class="m_nav_a" href="dispatch_caseSearch.html"><i class="glyphicon glyphicon-search mr10"></i>任务查询</a></li>
            </ul>
        </li>
        <li>
            <a class="m_navA" href="survey.html"><i class="glyphicon glyphicon-log-out mr10"></i>查勘</a>
            <ul class="m_nav_ul hidden">
                <li><a class="m_nav_a" href="survey.html"><i class="glyphicon glyphicon-map-marker mr10"></i>区域管理</a></li>
                <li><a class="m_nav_a" href="survey_new.html"><i class="glyphicon glyphicon-log-in mr10"></i>新任务</a></li>
                <li><a class="m_nav_a" href="survey_processing.html"><i class="glyphicon glyphicon-option-vertical mr10"></i>处理中</a></li>
                <li><a class="m_nav_a" href="survey_back.html"><i class="glyphicon glyphicon-alert mr10"></i>退回</a></li>
                <li><a class="m_nav_a" href="survey_inReview.html"><i class="glyphicon glyphicon-option-vertical mr10"></i>审核中</a></li>
                <li><a class="m_nav_a" href="survey_inSecretary.html"><i class="glyphicon glyphicon-option-vertical mr10"></i>内勤处理中</a></li>
                <li><a class="m_nav_a" href="survey_ok.html"><i class="glyphicon glyphicon-thumbs-up mr10"></i>已完成</a></li>
                <li><a class="m_nav_a" href="survey_documentCollection.html"><i class="glyphicon glyphicon-resize-small mr10"></i>单证收集</a></li>
                <li><a class="m_nav_a" href="survey_closure.html"><i class="glyphicon glyphicon-thumbs-up mr10"></i>已结案</a></li>
                <li><a class="m_nav_a" href="survey_caseSearch.html"><i class="glyphicon glyphicon-search mr10"></i>任务查询</a></li>
            </ul>
        </li>
        <li>
            <a class="m_navA" href="audit.html"><i class="glyphicon glyphicon-log-out mr10"></i>审核</a>
            <ul class="m_nav_ul hidden">
                <li><a class="m_nav_a" href="audit.html"><i class="glyphicon glyphicon-option-horizontal mr10"></i>待审核</a></li>
                <li><a class="m_nav_a" href="audit_ok.html"><i class="glyphicon glyphicon-thumbs-up mr10"></i>已审核</a></li>
                <li><a class="m_nav_a" href="audit_secretaryBack.html"><i class="glyphicon glyphicon-alert mr10"></i>内勤退回</a></li>
                <li><a class="m_nav_a" href="audit_backSurvey.html"><i class="glyphicon glyphicon-alert mr10"></i>退回查勘员</a></li>
                <li><a class="m_nav_a" href="audit_timeout.html"><i class="glyphicon glyphicon-alert mr10"></i>超时案件</a></li>
                <li><a class="m_nav_a" href="audit_timeStatistical.html"><i class="glyphicon glyphicon-dashboard mr10"></i>时效统计</a></li>
                <li><a class="m_nav_a" href="audit_caseSearch.html"><i class="glyphicon glyphicon-search mr10"></i>任务查询</a></li>
            </ul>
        </li>
        <li>
            <a class="m_navA" href="secretary.html"><i class="glyphicon glyphicon-log-out mr10"></i>内勤</a>
            <ul class="m_nav_ul hidden">
                <li><a class="m_nav_a" href="secretary.html"><i class="glyphicon glyphicon-option-horizontal mr10"></i>待录入</a></li>
                <li><a class="m_nav_a" href="secretary_ok.html"><i class="glyphicon glyphicon-thumbs-up mr10"></i>已录入</a></li>
                <li><a class="m_nav_a" href="secretary_backSurvey.html"><i class="glyphicon glyphicon-alert mr10"></i>退回查勘员</a></li>
                <li><a class="m_nav_a" href="secretary_waitClosure.html"><i class="glyphicon glyphicon-option-horizontal mr10"></i>待结案</a></li>
                <li><a class="m_nav_a" href="secretary_caseSearch.html"><i class="glyphicon glyphicon-search mr10"></i>任务查询</a></li>
            </ul>
        </li>
    </ul>
</div>
<div class="python">调度&nbsp;&gt;&nbsp;<a href="dispatch.html">调度管理</a>&nbsp;&gt;&nbsp;<a href="dpc_modifyCase.html">修改案件</a></div>
<!--内容-->
<div class="m_container">
    <div class="container-fluid">
        <!--案件信息-->
        <div class="dpc_box1 mt15">
            <form class="form-horizontal" role="form" name="myForm" ng-submit="submitForm()" novalidate>
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <div class="col-xs-offset-2 col-xs-10">
                                    <label class="radio-inline">
                                        <input type="radio" name="1"> 协议委托
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="1"> 非协议委托
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="1"> 非车险
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input1" class="col-xs-5 control-label"><span class="text-red">*</span>委托机构</label>
                                <div class="col-xs-7">
                                    <select class="form-control"
                                        ng-model="addCase.delegate_org.selectId"
                                        ng-options="value.delegateOrgId as value.delegateOrgName for value in addCase.delegate_org" required  popover popover-show="myForm.delegate_org.$error.required"   
                           popover-options='{"content": "委托机构不能为空", "placement": "bottom", "trigger": "manual"}' name="delegate_org">
                                        <option value="">--</option>
                                    </select>
                                    <!-- <select class="form-control" id="input1">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select> -->
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input2" class="col-xs-5 control-label">承保机构</label>
                                <div class="col-xs-7">


                                    <select class="form-control"
                                        ng-model="addCase.insurer.selectId"
                                        ng-options="value.insurerId as value.insurerName for value in addCase.insurer"  >
                                        <option value="">--</option>
                                    </select>
                                    <!-- <input type="text" class="form-control" id="input2" placeholder="请输入承保机构" ng-model="addCase.insurer.insurerName"> -->
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input3" class="col-xs-5 control-label"><span class="text-red">*</span>报案号</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="input3" placeholder="请输入报案号" required ng-model="addCase.reportNum" popover popover-show="myForm.reportNum.$error.required"   
                           popover-options='{"content": "报案号不能为空", "placement": "bottom", "trigger": "manual"}' name="reportNum">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input4" class="col-xs-5 control-label"><span class="text-red">*</span>车主</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="input4" placeholder="请输入车主" required ng-model='addCase.owner' popover popover-show="myForm.owner.$error.required"   
                           popover-options='{"content": "车主不能为空", "placement": "bottom", "trigger": "manual"}' name="owner">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input5" class="col-xs-5 control-label"><span class="text-red">*</span>车牌号</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="input5" placeholder="请输入车牌号" required ng-model="addCase.carNum" popover popover-show="myForm.carNum.$error.required"   
                           popover-options='{"content": "车主不能为空", "placement": "bottom", "trigger": "manual"}' name="carNum">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input6" class="col-xs-5 control-label">车辆品牌</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="input6" placeholder="请输入车辆品牌" ng-model="addCase.carBrand">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input7" class="col-xs-5 control-label"><span class="text-red">*</span>联系人</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="input7" placeholder="请输入联系人" required ng-model="addCase.contact" popover popover-show="myForm.contact.$error.required"   
                           popover-options='{"content": "车主不能为空", "placement": "bottom", "trigger": "manual"}' name="contact">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group has-feedback">
                                <label for="input8" class="col-xs-5 control-label"><span class="text-red">*</span>联系电话</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="input8" placeholder="请输入联系电话" required ng-model="addCase.contactPhone" ng-pattern="/^1\d{10}$/" name="contactPhone" popover popover-show="myForm.contactPhone.$error.required"   
                           popover-options='{"content": "联系电话不能为空", "placement": "bottom", "trigger": "manual"}' name="contactPhone">
                                    <span class="glyphicon glyphicon-ok form-control-feedback"
                              ng-show="myForm.contactPhone.$dirty && myForm.contactPhone.$valid"></span>

                              <span class="glyphicon glyphicon-remove form-control-feedback"
                              ng-show="myForm.contactPhone.$dirty && myForm.contactPhone.$invalid"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input9" class="col-xs-5 control-label">事故地点</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="input9" placeholder="请输入事故地点" ng-model="addCase.accidentLocation">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input10" class="col-xs-5 control-label">事故类型</label>
                                <div class="col-xs-7">
                                    <!-- <select class="form-control" id="input10"> -->


                                    <select class="form-control"
                                        ng-model="addCase.scene_type.selectId"
                                        ng-options="value.typeId as value.typeDesc for value in addCase.scene_type">
                                        <option value="">--</option>
                                    </select>
                                       
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input11" class="col-xs-5 control-label">事故责任</label>
                                <div class="col-xs-7">

                                <select class="form-control"
                                        ng-model="addCase.scene_resp.selectId"
                                        ng-options="value.respId as value.respDesc for value in addCase.scene_resp">
                                        <option value="">--</option>
                                    </select>
                                    <!-- <select class="form-control" id="input11">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select> -->


                                    
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input12" class="col-xs-5 control-label">报案时间</label>
                                <div class="col-xs-7">
                                   <div class="dropdown1">
                                    <a class="dropdown-toggle" id="dropdown1" role="button" data-toggle="dropdown" data-target=".dropdown1" href="#">
                                      <div class="input-group">
                                        <input type="text" id="date1" name="date1" class="form-control" data-ng-model="addCase.reportTime1">
                                        <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                    </div>
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                  <datetimepicker   data-ng-model="addCase.reportTime1 " 
                                  data-datetimepicker-config="{ dropdownSelector: '#dropdown1' ,minuteStep:1}"></datetimepicker>
                              </ul>
                        </div>

                               <!--  <input size="16" type="text" ng-model="addCase.reportTime" readonly class="form_datetime form-control" id="input12">
                                </div> -->


                             <!--    <div class="input-group col-xs-7 date  form_datetime" data-date-format="dd MM yyyy - HH:ii p" >
                                    
                                        <input class="form-control" type="text" ng-model="addCase.reportTime" readonly  id="input12">
                                        <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                                    
                                    </div> -->

                                    
                                </div>
                            </div>
                           </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input13" class="col-xs-5 control-label">出险时间</label>
                                <div class="col-xs-7">
                                  <div class="dropdown2">
                                    <a class="dropdown-toggle" id="dropdown2" role="button" data-toggle="dropdown" data-target=".dropdown2" href="#">
                                      <div class="input-group">
                                        <input type="text" id="date2" name="date2" class="form-control" data-ng-model="addCase.dangerTime1">
                                        <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                    </div>
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                  <datetimepicker   data-ng-model="addCase.dangerTime1 " 
                                  data-datetimepicker-config="{ dropdownSelector: '#dropdown2' ,minuteStep:1}"></datetimepicker>
                              </ul>
                        </div>

                                    <!-- <input type="text" class="form-control" id="input13" placeholder="请输入出险时间" ng-model="addCase.dangerTime">-->
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label class="col-xs-5 control-label">是否快赔</label>
                                <div class="col-xs-7">

                                    
   

                                    <label class="radio-inline">
                                        <input type="radio" ng-value=true ng-model="addCase.fastPay" name="2">是
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" ng-value=false ng-model="addCase.fastPay" name="2">否
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label class="col-xs-5 control-label">损失类型</label>
                                <div class="col-xs-7">
                                    <label class="checkbox-inline">
                                    <input type="checkbox" ng-model="addCase.lossType.person">
                                        人伤
                                    </label>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" ng-model="addCase.lossType.goods">物损
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input14" class="col-xs-5 control-label"><span class="text-red">*</span>事故描述</label>
                                <div class="col-xs-7">
                                    <textarea class="form-control" id="input14" rows="3" required ng-model="addCase.describe" popover popover-show="myForm.describe.$error.required"   
                           popover-options='{"content": "事故描述不能为空", "placement": "bottom", "trigger": "manual"}' name="describe"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group">
                                <label for="input15" class="col-xs-5 control-label">重点关注</label>
                                <div class="col-xs-7">
                                    <textarea class="form-control" id="input15" rows="3" ng-model="addCase.focus"></textarea>
                                </div>
                            </div>
                        </div>
                    <div class="col-xs-12 text-center mt15">
                        <button class="btn btn-primary mr10" type="submit" id="submit"> 保存</button>
                        <a class="btn btn-primary" data-toggle="modal" data-target="#note">备注</a>
                    </div>
                </div>
            </form>
        </div>
        <!--工单-->
        <div class="dpc_box1 mt15">
            <!--添加工单等按钮-->
            <a class="btn btn-primary mr10" data-toggle="modal" data-target="#addWorkOrder">添加工单</a>
            <a class="btn btn-primary mr10" data-toggle="modal" data-target="#modifyWorkOrder">派工/改派</a>
        </div>
        <div class="dpc_box2">
            <div class="ofXAo">
                <table class="table table-striped minWidth960">
                    <thead>
                    <tr>
                        <th><input type="checkbox"  ng-model="selectAll" ng-click="all(selectAll)"></th>
                        <th>任务类型</th>
                        <th>派工状态</th>
                        <th>车牌号</th>
                        <th>品牌型号</th>
                        <th>委托机构</th>
                        <th>承保机构</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="(key,task) in tasks">
                        <td><input type="checkbox"  ng-model="task.taskstate" ng-click="one()"></td>
                        <td>{{task.taskType}}</td>
                        <td>{{task.billState}}</td>
                        <td>{{task.carNum}}</td>
                        <td>{{task.carBrand}}</td>
                        <td>{{task.delegate_orgName}}</td>
                        <td>{{task.insurerName}}</td>
                        <td ng-if="!task.isLock"><button class="btn btn-default btn-sm"  ng-click="task.isLock=true">锁定</button></td>
                        <td ng-if="task.isLock"><button class="btn btn-default btn-sm"  ng-click="task.isLock=false">恢复</button></td>
                    </tr>
                    <!-- <tr>
                        <td><input type="checkbox" ng-checked="selectAll" ng-model="task.state"></td>
                        <td>任务类型</td>
                        <td>派工状态</td>
                        <td>车牌号</td>
                        <td>品牌型号</td>
                        <td>委托机构</td>
                        <td>承保机构</td>
                        <td><button class="btn btn-default btn-sm">锁定</button></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" ng-checked="selectAll" ng-model="task.state"></td>
                        <td>任务类型</td>
                        <td>派工状态</td>
                        <td>车牌号</td>
                        <td>品牌型号</td>
                        <td>委托机构</td>
                        <td>承保机构</td>
                        <td><button class="btn btn-default btn-sm">锁定</button></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" ng-checked="selectAll" ng-model="task.state"></td>
                        <td>任务类型</td>
                        <td>派工状态</td>
                        <td>车牌号</td>
                        <td>品牌型号</td>
                        <td>委托机构</td>
                        <td>承保机构</td>
                        <td><button class="btn btn-default btn-sm">锁定</button></td>
                    </tr> -->
                    </tbody>
                </table>
            </div>
        </div>
        <!--案件进程-->
        <div class="dpc_box1 mt15">案件进程</div>
        <div class="dpc_box2">
            <div class="ofXAo">
                <table class="table table-striped minWidth960">
                    <thead>
                    <tr>
                        <th>序号</th>
                        <th>任务类型</th>
                        <th>任务类型</th>
                        <th>调度时间</th>
                        <th>派发员</th>
                        <th>业务员</th>
                        <th>车牌号</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>1</td>
                        <td>任务类型</td>
                        <td>任务类型</td>
                        <td>调度时间</td>
                        <td>派发员</td>
                        <td>业务员</td>
                        <td>车牌号</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>任务类型</td>
                        <td>任务类型</td>
                        <td>调度时间</td>
                        <td>派发员</td>
                        <td>业务员</td>
                        <td>车牌号</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>任务类型</td>
                        <td>任务类型</td>
                        <td>调度时间</td>
                        <td>派发员</td>
                        <td>业务员</td>
                        <td>车牌号</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!--备注弹框-->
<div class="modal fade" id="note" tabindex="-1" role="dialog" aria-labelledby="noteLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="noteLabel">备注</h4>
            </div>
            <div class="modal-body">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>操作人员</th>
                        <th>操作时间</th>
                        <th>操作备注</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>操作人员</td>
                        <td>操作时间</td>
                        <td>操作备注</td>
                    </tr>
                    <tr>
                        <td>操作人员</td>
                        <td>操作时间</td>
                        <td>操作备注</td>
                    </tr>
                    <tr>
                        <td>操作人员</td>
                        <td>操作时间</td>
                        <td>操作备注</td>
                    </tr>
                    </tbody>
                </table>
                <div class="row">
                    <div class="form-group">
                        <label for="inputP1" class="col-xs-2 control-label">备注</label>
                        <div class="col-xs-10">
                            <textarea class="form-control" id="inputP1" rows="3"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary">提交</button>
            </div>
        </div>
    </div>
</div>
<!--添加工单弹框-->
<div class="modal fade" id="addWorkOrder" tabindex="-1" role="dialog" aria-labelledby="addWorkOrderLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="addWorkOrderLabel">添加工单</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="inputPT1" class="col-xs-5 control-label"><span class="text-red">*</span>车牌号</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="inputPT1" placeholder="请输入车牌号">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="col-xs-5 control-label">损失类型</label>
                                <div class="col-xs-7">
                                    <label class="checkbox-inline">
                                        <input type="checkbox"> 三者
                                    </label>
                                    <label class="checkbox-inline">
                                        <input type="checkbox"> 人伤
                                    </label>
                                    <label class="checkbox-inline">
                                        <input type="checkbox"> 物损
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="inputPT2" class="col-xs-5 control-label"><span class="text-red">*</span>联系人</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="inputPT2" placeholder="请输入联系人">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="inputPT3" class="col-xs-5 control-label"><span class="text-red">*</span>联系电话</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="inputPT3" placeholder="请输入联系电话">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="inputPT4" class="col-xs-5 control-label"><span class="text-red">*</span>车辆型号</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="inputPT4" placeholder="请输入车辆型号">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="inputPT5" class="col-xs-5 control-label"><span class="text-red">*</span>维修厂名称</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="inputPT5" placeholder="请输入维修厂名称">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="inputPT6" class="col-xs-5 control-label"><span class="text-red">*</span>维修厂联系人</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="inputPT6" placeholder="请输入维修厂联系人">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="inputPT7" class="col-xs-5 control-label"><span class="text-red">*</span>维修厂联系电话</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="inputPT7" placeholder="请输入维修厂联系电话">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="inputPT8" class="col-xs-5 control-label">维修厂地址</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="inputPT8" placeholder="请输入维修厂地址">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="inputPT9" class="col-xs-5 control-label">备注</label>
                                <div class="col-xs-7">
                                    <input type="text" class="form-control" id="inputPT9" placeholder="请输入备注">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary">提交</button>
            </div>
        </div>
    </div>
</div>
<!--改派工单弹框-->
<div class="modal fade" id="modifyWorkOrder" tabindex="-1" role="dialog" aria-labelledby="modifyWorkOrderLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modifyWorkOrderLabel">添加工单</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label for="inputPTh1" class="col-xs-3 control-label">区域</label>
                        <div class="col-xs-3">
                            <select class="form-control" id="inputPTh1">
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                            </select>
                        </div>
                        <div class="col-xs-3">
                            <select class="form-control" id="inputPTh1_1">
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                            </select>
                        </div>
                        <div class="col-xs-3">
                            <select class="form-control" id="inputPTh1_2">
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputPTh2" class="col-xs-3 control-label">查勘员</label>
                        <div class="col-xs-9">
                            <select class="form-control" id="inputPTh2">
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputPTh3" class="col-xs-3 control-label">短信信息</label>
                        <div class="col-xs-9">
                            <textarea class="form-control" id="inputPTh3" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputPTh4" class="col-xs-3 control-label">备注</label>
                        <div class="col-xs-9">
                            <textarea class="form-control" id="inputPTh4" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary">提交</button>
            </div>
        </div>
    </div>
</div>
<script src="../js/moment.js"></script>
<script src="../js/locale/zh-cn.js"></script>
<script  src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/angular.min.js"></script>
<script src="../js/service.js"></script>
<script src="../js/datetimepicker.js"></script>
<script src="../js/datetimepicker.templates.js"></script>
<script>
    var app = angular.module("app",['MyService','ui.bootstrap.datetimepicker']);
    app.controller('ctrl', ['$scope','$http','urlService', '$timeout','$parse','$filter','$window',function($scope,$http,urlService,$timeout,$parse,$filter,$window){
        moment.locale('zh-cn');
        $scope.addCase={}
        $scope.addCase.delegate_org={};
        $scope.addCase.insurer={};
        $scope.addCase.scene_type={};
        $scope.addCase.scene_resp={};
        $scope.addCase.lossType={};
        var data=JSON.parse(localStorage.getItem("addCaseMsg"));

        $scope.addCase.delegate_org=JSON.parse(localStorage.getItem("delegate_org"))
        $scope.addCase.scene_resp =JSON.parse(localStorage.getItem("scene_resp"))
        $scope.addCase.insurer=JSON.parse(localStorage.getItem("insurer"))
        $scope.addCase.scene_type=JSON.parse(localStorage.getItem("scene_type"))
        console.log(localStorage.getItem("addCaseMsg"))

        // localStorage.removeItem("addCaseMsg");

        // 委托机构
        $scope.addCase.delegate_org.selectId=data.msg.T_CASE_INFO.delegateOrgId
        // 承保机构
        $scope.addCase.insurer.selectId=data.msg.T_CASE_INFO.insurerId
        // 报案号 
        $scope.addCase.reportNum =data.msg.T_CASE_INFO.caseId;
        // 车主
        $scope.addCase.owner=data.msg.T_CASE_INFO.ownerName
        // 车牌号 
        $scope.addCase.carNum =data.msg.T_CASE_INFO.carNumber
        // 车辆品牌
        $scope.addCase.carBrand =data.msg.T_CASE_INFO.carBrand
        // 联系人
        $scope.addCase.contact=data.msg.T_CASE_INFO.reporterName
        // 联系电话  
        $scope.addCase.contactPhone =data.msg.T_CASE_INFO.reporterPhone     
        // 事故地点
        $scope.addCase.accidentLocation =data.msg.T_CASE_INFO.sceneLocation
        // 事故类型 
        $scope.addCase.scene_type.selectId= data.msg.T_CASE_INFO.sceneTypeId


        // 事故责任 
        $scope.addCase.scene_resp.selectId=data.msg.T_CASE_INFO.sceneRespId
        // 报案时间 
        // $scope.addCase.reportTime=data.msg.T_CASE_INFO.reportTime
        
        var reportTime=data.msg.T_CASE_INFO.reportTime;
        $scope.addCase.reportTime=new Date(Number(reportTime.year),Number(reportTime.month),Number(reportTime.day),Number(reportTime.hours),Number(reportTime.minutes))
         $scope.addCase.reportTime1 = $filter("date")($scope.addCase.reportTime, "yyyy-MM-dd HH:mm");
        // 出险时间 
        // $scope.addCase.dangerTime =data.msg.T_CASE_INFO.sceneTime
        var sceneTime=data.msg.T_CASE_INFO.sceneTime;
        $scope.addCase.dangerTime=new Date(Number(sceneTime.year),Number(sceneTime.month),Number(sceneTime.day),Number(sceneTime.hours),Number(sceneTime.minutes),0)
         $scope.addCase.dangerTime1 = $filter("date")($scope.addCase.dangerTime, "yyyy-MM-dd HH:mm");

         $scope.$watch('addCase.reportTime1',function(newValue,oldValue, scope){
                scope.addCase.reportTime1 = $filter("date")(newValue, "yyyy-MM-dd HH:mm");
                scope.addCase.reportTime=new Date($scope.addCase.reportTime1)
               })

               $scope.$watch('addCase.dangerTime1',function(newValue,oldValue, scope){
                scope.addCase.dangerTime1 = $filter("date")(newValue, "yyyy-MM-dd HH:mm");
                scope.addCase.dangerTime=new Date($scope.addCase.dangerTime1)
               })

        // 快赔
        $scope.addCase.fastPay  =Boolean(data.msg.T_CASE_INFO.isQuick)
        // 损失类型 
        $scope.addCase.lossType.person =Boolean(data.msg.T_CASE_INFO.isHumanHurt)

        $scope.addCase.lossType.goods=Boolean(data.msg.T_CASE_INFO.isMatDamage)

        // 事故描述
        $scope.addCase.describe =data.msg.T_CASE_INFO.sceneDesc
        // 重点关注
        $scope.addCase.focus =data.msg.T_CASE_INFO.importDesc

        $scope.tasks=[];


        taskObj={};
        // 任务id     
        taskObj.taskId=data.msg.T_SURVEY_BILL.billId
        // 选择状态    
        taskObj.taskstate=true
        // 任务类型    
        taskObj.taskType=data.msg.T_SURVEY_BILL.billType
        // 派工状态    
        taskObj.billState=data.msg.T_SURVEY_BILL.billStateId
        // 车牌号      
        taskObj.carNum=data.msg.T_SURVEY_BILL.targetCarNo
        // 品牌型号    
        taskObj.carBrand=data.msg.T_SURVEY_BILL.targetBrand
        // 委托机构    
        taskObj.delegate_orgName='1'
        // $scope.addCase.delegate_org[data.msg.T_SURVEY_BILL.delegateOrgId]
        // 承保机构  
        taskObj.insurerName='1'
        // $scope.addCase.insurer[data.msg.T_SURVEY_BILL.insurerId]
        // 操作      
        taskObj.isLock=Boolean(data.msg.T_SURVEY_BILL.isLock)
        $scope.tasks.push(taskObj)


        var taskObj={};
        // 任务id      
        taskObj.taskId=data.msg.T_TARGET_BILL.billId
        // 选择状态    
        taskObj.taskstate=true
        // 任务类型    
        taskObj.taskType=data.msg.T_TARGET_BILL.billType
        // 派工状态    
        taskObj.billState=data.msg.T_TARGET_BILL.billStateId
        // 车牌号      
        taskObj.carNum=data.msg.T_TARGET_BILL.targetCarNo
        // 品牌型号    
        taskObj.carBrand=data.msg.T_TARGET_BILL.targetBrand
        // 委托机构    
        taskObj.delegate_orgName='2'
        // $scope.addCase.delegate_org[data.msg.T_CASE_INFO.delegateOrgId]
        // 承保机构  
        taskObj.insurerName='2'
        // $scope.addCase.insurer[data.msg.T_CASE_INFO.insurerId]
        // 操作      
        taskObj.isLock=Boolean(data.msg.T_TARGET_BILL.isLock)
        $scope.tasks.push(taskObj)



        if(data.msg.T_THIRD_BILL){

        taskObj={};
        // 任务id      
        taskObj.taskId=data.msg.T_THIRD_BILL.billId
        // 选择状态    
        taskObj.taskstate=true
        // 任务类型    
        taskObj.taskType=data.msg.T_THIRD_BILL.billType
        // 派工状态    
        taskObj.billState=data.msg.T_THIRD_BILL.billStateId
        // 车牌号      
        taskObj.carNum=data.msg.T_THIRD_BILL.targetCarNo
        // 品牌型号    
        taskObj.carBrand=data.msg.T_THIRD_BILL.targetBrand
        // 委托机构    
        taskObj.delegate_orgName='3'
        // $scope.addCase.delegate_org[data.msg.T_THIRD_BILL.delegateOrgId]
        // 承保机构  
        taskObj.insurerName='3'
        // $scope.addCase.insurer[data.msg.T_THIRD_BILL.insurerId]
        // 操作      
        taskObj.isLock=Boolean(data.msg.T_THIRD_BILL.isLock) 

        $scope.tasks.push(taskObj)
        }
        console.log($scope.tasks)


        $scope.selectAll=true;  
       
        $scope.all= function (m) {  
            for(var i=0;i<$scope.tasks.length;i++){  
                if(m===true){  
                    $scope.tasks[i].taskstate=true;  
                }else {  
                    $scope.tasks[i].taskstate=false;  
                }  
            }  
        };  

        $scope.one= function () {  
             
            for(var i=0;i<$scope.tasks.length;i++){  
                    if(!$scope.tasks[i].taskstate){
                      $timeout(function() {
                        $scope.selectAll=false; 
                    })
                      return;
                    }
                }
                $timeout(function() {
                    $scope.selectAll=true; 
                    $parse($scope.selectAll)($scope);
                    
                })
            }

        $scope.submitForm = function() {
            if($scope.myForm.$invalid){
                console.log($('#submit'))
                $('#submit').popover({ "placement": "bottom", "trigger": "manual" ,"content":"还有必填项未完成或者所填格式错误"});  
                $('#submit').popover('show');  
                return;
            }
                    // console.log(angular.toJson($scope.addCase,0))
                     var postData={
                   'caseId':$scope.addCase.reportNum,
                   'caseInnerId':data.msg.T_CASE_INFO.caseInnerId,
                   'delegateType':1,
                   'delegateOrgId':$scope.addCase.delegate_org.selectId,
                   'insurerId':$scope.addCase.insurer.selectId,
                   'ownerName':$scope.addCase.owner,
                   'carNumber':$scope.addCase.carNum,
                   'carBrand':$scope.addCase.carBrand,
                   'reporterName':$scope.addCase.contact,
                   'reporterPhone':$scope.addCase.contactPhone,
                   'sceneLocation':$scope.addCase.accidentLocation,
                   'sceneTypeId':$scope.addCase.scene_type.selectId,
                   'sceneRespId':$scope.addCase.scene_resp.selectId,
                   'reportTime':$scope.addCase.reportTime,
                   'sceneTime':$scope.addCase.dangerTime,
                   'isQuick':$scope.addCase.fastPay,
                   'isHumanHurt':$scope.addCase.lossType.person,  
                   'isMatDamage':$scope.addCase.lossType.goods,
                   'sceneDesc':$scope.addCase.describe,
                   'importDesc':$scope.addCase.focus,
                   'createUserId':"ffy8weu34423244"
                };
                console.log(postData)
                 $http({
                    method: 'POST',
                    url: urlService.getCommonUrl()+'case/edit',
                    headers: {'Content-Type': 'application/json','accesskey':'acaaaa'},
                    data:postData

                    // transformRequest: function(obj) {
                    //     var str = [];
                    //     for(var p in obj)
                    //     str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                    //     return str.join("&");

                    //     }
                    }).then(function(data1) {
                        console.log(data1)
                        
                    },function(error){
                        alert("2222")
                        console.log(error)
                    })
                }
        
       // $http({
       //          method: 'POST',
       //          url: urlService.getCommonUrl()+'case/add',
       //          headers: {'Content-Type': 'application/json'},
       //          transformRequest: function(obj) {
       //              var str = [];
       //              for(var p in obj)
       //              str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
       //              return str.join("&");

       //              }
       //          }).then(function(data) {
       //              console.log(data)
       //          },function(error){
       //                   console.log(error)
       //          })
    }])
</script>
</body>
</html>